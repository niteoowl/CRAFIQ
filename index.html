<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRAFIQ - ëˆ„êµ¬ë‚˜ ì‘ê°€ê°€ ë˜ëŠ” ê³³</title>
    <!-- Pretendard Font -->
    <link rel="stylesheet" as="style" crossOrigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    <link rel="stylesheet" href="style.css">

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="js/turbo-router.js"></script>
    <script src="js/app.js"></script>
    <script>
        function toggleSearch() {
            const overlay = document.getElementById('searchOverlay');
            overlay.style.display = (overlay.style.display === 'flex') ? 'none' : 'flex';
            if (overlay.style.display === 'flex') document.getElementById('mobileSearchInput').focus();
        }
        window.toggleSearch = toggleSearch;
    </script>

    <!-- Dynamic Content Injector -->
    <script type="module">
        import { getRecentPublishedNovels, getNovelsByCategory } from './js/data.js';

        async function initHome() {
            // Give time for Supabase to init
            await new Promise(r => setTimeout(r, 100));

            // Helper to render lists
            const renderList = (elementId, list) => {
                const container = document.getElementById(elementId);
                if (!container) return;

                if (list && list.length > 0) {
                    container.innerHTML = list.map(n => `
                        <a href="detail.html?id=${n.id}" class="item">
                            <div class="book-cover">
                                <img src="${n.cover_url || 'https://via.placeholder.com/150'}" loading="lazy">
                                ${n.is_visual_novel ? '<span style="position:absolute; top:4px; right:4px; background:rgba(0,0,0,0.6); color:white; padding:2px 6px; border-radius:4px; font-size:10px;">ğŸ® Game</span>' : ''}
                            </div>
                            <div class="book-title">${n.title}</div>
                            <div class="book-meta">${n.profiles?.username || 'ì‘ê°€'}</div>
                        </a>
                    `).join('');
                } else {
                    container.innerHTML = '<div style="padding:20px; color:#666; font-size:13px;">ë“±ë¡ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            };

            // 1. Hot New (Recent)
            const { data: recent } = await getRecentPublishedNovels();
            renderList('homeRecentList', recent);

            // 2. Featured (MD Pick - Mocked for now as Random or Specific)
            // (Assuming Featured is just top recent for this sprint)
            const featuredContainer = document.getElementById('homeFeaturedList');
            if (featuredContainer && recent) {
                featuredContainer.innerHTML = recent.slice(0, 5).map(n => `
                     <a href="detail.html?id=${n.id}" class="item wide-item">
                        <div class="wide-cover"><img src="${n.cover_url || 'https://via.placeholder.com/600x300'}" style="object-fit:cover;"></div>
                        <div class="book-title">${n.title}</div>
                        <div class="book-meta">${n.description || n.profiles?.username || 'ì¶”ì²œ ì‘í’ˆ'}</div>
                    </a>
                `).join('');
            }

            // 3. Romance Section
            const { data: romance } = await getNovelsByCategory('Romance');
            renderList('homeRomanceList', romance);

            // 4. Fantasy Section
            const { data: fantasy } = await getNovelsByCategory('Fantasy');
            renderList('homeFantasyList', fantasy);

            // 5. Wuxia Section (using homeWuxiaList id if exists, otherwise create it in HTML)
            const { data: wuxia } = await getNovelsByCategory('Wuxia');
            renderList('homeWuxiaList', wuxia);
        }

        window.addEventListener('DOMContentLoaded', initHome);
        // Turbo Router fallback
        if (document.body.getAttribute('data-turbo-loaded')) initHome();
    </script>
</head>

<body>
    <div id="searchOverlay" class="search-overlay">
        <div class="search-overlay-header">
            <svg onclick="toggleSearch()" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none"
                viewBox="0 0 24 24" style="margin-right:12px; cursor:pointer;">
                <path d="M15 19l-7-7 7-7" />
            </svg>
            <input id="mobileSearchInput" class="search-overlay-input" placeholder="ê²€ìƒ‰">
        </div>
        <div class="search-recent">
            <span class="search-tag">ì „ì§€ì  ë…ì ì‹œì </span>
            <span class="search-tag">í™”ì‚°ê·€í™˜</span>
            <span class="search-tag">ë¡œë§¨ìŠ¤íŒíƒ€ì§€</span>
            <span class="search-tag">ë¨¼ì¹˜í‚¨</span>
        </div>
    </div>

    <header>
        <div class="header-inner">
            <a href="index.html" class="brand">CRAFIQ</a>
            <nav class="nav-pc desktop-only">
                <a href="index.html" class="active">í™ˆ</a>
                <a href="discover.html">íƒìƒ‰</a>
                <a href="best.html">ë² ìŠ¤íŠ¸</a>
                <a href="my.html">MY</a>
            </nav>
            <div class="header-right-pc desktop-only">
                <div class="search-wrap-pc">
                    <svg width="18" height="18" stroke="#999" stroke-width="2" fill="none" viewBox="0 0 24 24">
                        <circle cx="11" cy="11" r="8" />
                        <path d="M21 21L16.65 16.65" />
                    </svg>
                    <input placeholder="ì‘í’ˆ ê²€ìƒ‰">
                </div>
                <a href="dashboard.html" class="btn-studio">ìŠ¤íŠœë””ì˜¤</a>
            </div>
            <div class="mobile-only" style="margin-left:auto;">
                <button onclick="toggleSearch()" class="mobile-search-btn"><svg width="24" height="24"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8" />
                        <path d="M21 21L16.65 16.65" />
                    </svg></button>
            </div>
        </div>
    </header>

    <main class="inner">
        <!-- MOBILE TABS -->
        <div class="sub-nav mobile-only"
            style="padding:16px 16px 0; gap:20px; font-weight:600; color:#888; border-bottom:1px solid #f0f0f0; margin-bottom:20px; overflow-x:auto;">
            <span
                style="color:#000; font-weight:800; border-bottom:2px solid #000; padding-bottom:12px; display:inline-block;">í™ˆ</span>
            <span style="padding-bottom:12px; display:inline-block;">ì‹¤ì‹œê°„</span>
            <span style="padding-bottom:12px; display:inline-block;">ì´ë²¤íŠ¸</span>
            <span style="padding-bottom:12px; display:inline-block;">ë¬´ë£Œ</span>
            <span style="padding-bottom:12px; display:inline-block;">íŒíƒ€ì§€</span>
            <span style="padding-bottom:12px; display:inline-block;">ë¡œë§¨ìŠ¤</span>
        </div>

        <!-- HERO -->
        <div class="hero-wrap">
            <img src="https://images.unsplash.com/photo-1541963463532-d68292c34b19?w=1200&q=80" class="hero-img">
            <div class="hero-overlay">
                <span
                    style="background:white; color:black; font-size:11px; font-weight:800; padding:4px 8px; border-radius:4px; align-self:flex-start; margin-bottom:8px;">ë…ì 
                    ê³µê°œ</span>
                <div style="color:white; font-size:24px; font-weight:800; line-height:1.3;">ê·¸ë…€ê°€ ê³µì‘ì €ë¡œ<br>ê°€ì•¼ í–ˆë˜ ì‚¬ì •</div>
                <div style="color:rgba(255,255,255,0.8); font-size:14px; margin-top:8px;">ëŒì•„ì˜¨ ë ˆì „ë“œ ë¡œíŒ, ì§€ê¸ˆ ë°”ë¡œ ì •ì£¼í–‰!</div>
            </div>
        </div>

        <!-- Section 1: Hot New -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">ğŸ”¥ í™”ì œì˜ ì‹ ì‘</h2>
                <a href="discover.html" class="sec-more">ë”ë³´ê¸°</a>
            </div>
            <div id="homeRecentList" class="h-scroll-view">
                <!-- Data injected by initHome() -->
                <div class="loading-placeholder">Loading recent novels...</div>
            </div>
        </section>

        <!-- Section 2: Editor's Pick (Dynamic) -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">MD's Pick: ì´ë²ˆ ì£¼ í•„ë…</h2>
            </div>
            <div id="homeFeaturedList" class="h-scroll-view">
                <div style="padding:20px; color:#888;">ì¶”ì²œ ì‘í’ˆ ë¡œë”© ì¤‘...</div>
            </div>
        </section>

        <!-- Section 3: Ranking -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">ğŸ† ì‹¤ì‹œê°„ ë­í‚¹</h2>
                <a href="best.html" class="sec-more">ì „ì²´</a>
            </div>
            <div class="rank-list" style="padding:0;">
                <a href="#" class="rank-item" style="padding:12px 16px;">
                    <div class="rank-num">1</div>
                    <div class="rank-thumb"><img
                            src="https://images.unsplash.com/photo-1516410541193-6dbf07918b8b?w=200"></div>
                    <div class="rank-info">
                        <div class="rank-title">ê´‘ë§ˆíšŒê·€</div>
                        <div class="rank-desc">ìœ ì§„ì„± â€¢ ë¬´í˜‘</div>
                        <div class="rank-tags"><span class="tag-sm">ë¨¼ì¹˜í‚¨</span><span class="tag-sm">ì‚¬ì´ë‹¤</span></div>
                    </div>
                </a>
                <a href="#" class="rank-item" style="padding:12px 16px;">
                    <div class="rank-num">2</div>
                    <div class="rank-thumb"><img
                            src="https://images.unsplash.com/photo-1501250987900-1b8a1a2a4bcf?w=200"></div>
                    <div class="rank-info">
                        <div class="rank-title">ë°ë·” ëª» í•˜ë©´ ì£½ëŠ” ë³‘</div>
                        <div class="rank-desc">ë°±ë•ìˆ˜ â€¢ ì•„ì´ëŒ</div>
                        <div class="rank-tags"><span class="tag-sm">ì•„ì´ëŒ</span><span class="tag-sm">ë¹™ì˜</span></div>
                    </div>
                </a>
                <a href="#" class="rank-item" style="padding:12px 16px;">
                    <div class="rank-num">3</div>
                    <div class="rank-thumb"><img
                            src="https://images.unsplash.com/photo-1626544827763-d516dce335e2?w=200"></div>
                    <div class="rank-info">
                        <div class="rank-title">ë‚˜ë…¸ ë§ˆì‹ </div>
                        <div class="rank-desc">í•œì¤‘ì›”ì•¼ â€¢ ë¬´í˜‘</div>
                        <div class="rank-tags"><span class="tag-sm">ë¯¸ë˜</span><span class="tag-sm">ë‚˜ë…¸</span></div>
                    </div>
                </a>
                <a href="#" class="rank-item" style="padding:12px 16px;">
                    <div class="rank-num">4</div>
                    <div class="rank-thumb"><img
                            src="https://images.unsplash.com/photo-1513001900722-370f8deed956?w=200"></div>
                    <div class="rank-info">
                        <div class="rank-title">ë¹„ë¢°ë„</div>
                        <div class="rank-desc">ê²€ë¥˜í˜¼ â€¢ ë¬´í˜‘</div>
                        <div class="rank-tags"><span class="tag-sm">í•™êµ</span><span class="tag-sm">ê°œê·¸</span></div>
                    </div>
                </a>
            </div>
        </section>

        <!-- BANNER -->
        <div style="margin-bottom:56px; overflow:hidden; aspect-ratio:4/1; background:#000; position:relative;">
            <img src="https://images.unsplash.com/photo-1513542789411-b6a5d4f31634?w=1200&q=80"
                style="opacity:0.6; width:100%; height:100%; object-fit:cover;">
            <div
                style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; color:white;">
                <div style="font-size:14px; font-weight:700; color:#ffdd59; margin-bottom:8px;">EVENT</div>
                <div style="font-size:20px; font-weight:900;">ë§¤ì¼ 10ì‹œ ë¬´ë£Œ ëŒ€ë°©ì¶œ</div>
            </div>
        </div>

        <!-- Section 4: Romance -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">ğŸ’• ë¡œë§¨ìŠ¤ ê¸°ëŒ€ì‘</h2>
                <a href="discover.html?q=Romance" class="sec-more">ë”ë³´ê¸°</a>
            </div>
            <div id="homeRomanceList" class="h-scroll-view">
                <div class="loading-placeholder">ë¡œë§¨ìŠ¤ ì‘í’ˆ ë¡œë”© ì¤‘...</div>
            </div>
        </section>

        <!-- Section 5: Fantasy -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">âš”ï¸ íŒíƒ€ì§€ ëª…ì‘</h2>
                <a href="discover.html?q=Fantasy" class="sec-more">ë”ë³´ê¸°</a>
            </div>
            <div id="homeFantasyList" class="h-scroll-view">
                <div class="loading-placeholder">íŒíƒ€ì§€ ì‘í’ˆ ë¡œë”© ì¤‘...</div>
            </div>
        </section>

        <!-- Section 6: Now Free -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">ğŸ ì§€ê¸ˆë§Œ ë¬´ë£Œ!</h2>
                <a href="discover.html" class="sec-more">ë”ë³´ê¸°</a>
            </div>
            <div class="h-scroll-view">
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1519074069444-1ba4fff66d16?w=300">
                        <div
                            style="position:absolute; top:0; left:0; background:#f00; color:white; font-size:10px; padding:2px 4px; font-weight:700;">
                            10í™” ë¬´ë£Œ</div>
                    </div>
                    <div class="book-title">ë‹¬ë¹› ì¡°ê°ì‚¬</div>
                    <div class="book-meta">ë‚¨í¬ì„±</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=300">
                        <div
                            style="position:absolute; top:0; left:0; background:#f00; color:white; font-size:10px; padding:2px 4px; font-weight:700;">
                            10í™” ë¬´ë£Œ</div>
                    </div>
                    <div class="book-title">ìŠ¬ë¼ì„ ì „ìƒ</div>
                    <div class="book-meta">í“¨ì¦ˆ</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1614726365723-49cfa0950ecb?w=300">
                        <div
                            style="position:absolute; top:0; left:0; background:#f00; color:white; font-size:10px; padding:2px 4px; font-weight:700;">
                            20í™” ë¬´ë£Œ</div>
                    </div>
                    <div class="book-title">ë‚˜ í˜¼ìë§Œ ë ˆë²¨ì—…</div>
                    <div class="book-meta">ì¶”ê³µ</div>
                </a>
            </div>
        </section>

        <!-- Section 7: Wait Free -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">â° ê¸°ë‹¤ë¦¬ë©´ ë¬´ë£Œ</h2>
                <a href="discover.html" class="sec-more">ë”ë³´ê¸°</a>
            </div>
            <div class="h-scroll-view">
                <a href="#" class="item">
                    <div class="book-cover"><img src="https://images.unsplash.com/photo-1544947950-fa07a98d237f?w=300">
                        <div
                            style="position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.6); color:white; font-size:10px; text-align:center; padding:2px 0;">
                            3ì‹œê°„ë§ˆë‹¤ ë¬´ë£Œ</div>
                    </div>
                    <div class="book-title">ë‚˜ë¥¼ ì¡ì•„ë¨¹ì§€ ë§ì•„ìš”</div>
                    <div class="book-meta">ë¡œë§¨ìŠ¤</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img src="https://images.unsplash.com/photo-1543002588-bfa74002ed7e?w=300">
                        <div
                            style="position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.6); color:white; font-size:10px; text-align:center; padding:2px 0;">
                            12ì‹œê°„ë§ˆë‹¤ ë¬´ë£Œ</div>
                    </div>
                    <div class="book-title">í™©ë…€ë‹˜ì´ ëŒì•„ì˜¤ì…¨ë‹¤</div>
                    <div class="book-meta">ë¡œíŒ</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1589829085413-56de8ae18c73?w=300">
                        <div
                            style="position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.6); color:white; font-size:10px; text-align:center; padding:2px 0;">
                            24ì‹œê°„ë§ˆë‹¤ ë¬´ë£Œ</div>
                    </div>
                    <div class="book-title">ê²€ìˆ ëª…ê°€ ë§‰ë‚´ì•„ë“¤</div>
                    <div class="book-meta">íŒíƒ€ì§€</div>
                </a>
            </div>
        </section>

        <!-- Section 8: Completed -->
        <section class="section">
            <div class="section-head">
                <h2 class="sec-title">ğŸ“š ì£¼ë§ ìˆœì‚­ ì™„ê²°ì‘</h2>
                <a href="discover.html" class="sec-more">ë”ë³´ê¸°</a>
            </div>
            <div class="h-scroll-view">
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1514539079130-25950c84af65?w=300"></div>
                    <div class="book-title">í™”ì‚°ê·€í™˜</div>
                    <div class="book-meta">500í™” ì™„ê²°</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1463171379577-7f9923021716?w=300"></div>
                    <div class="book-title">ì „ì§€ì  ë…ì ì‹œì </div>
                    <div class="book-meta">551í™” ì™„ê²°</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=300"></div>
                    <div class="book-title">ì¬ë²Œì§‘ ë§‰ë‚´ì•„ë“¤</div>
                    <div class="book-meta">326í™” ì™„ê²°</div>
                </a>
                <a href="#" class="item">
                    <div class="book-cover"><img
                            src="https://images.unsplash.com/photo-1535905557558-afc4877a26fc?w=300"></div>
                    <div class="book-title">í…œë¹¨</div>
                    <div class="book-meta">1000í™”+</div>
                </a>
            </div>
        </section>


        <footer>
            (ì£¼)í¬ë¼í”½ | ì‚¬ì—…ì ì •ë³´ í™•ì¸ | ì´ìš©ì•½ê´€<br>
            Copyight Â© CRAFIQ Corp. All rights reserved.
        </footer>
    </main>

    <!-- ACTIVE STATE: HOME -->
    <nav class="bottom-nav mobile-only">
        <a href="index.html" class="nav-btn active"><svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 3L4 9v12h5v-7h6v7h5V9z" />
            </svg><span>í™ˆ</span></a>
        <a href="discover.html" class="nav-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <path d="M16 8l-2 6-6 2 2-6 6-2z" />
            </svg><span>íƒìƒ‰</span></a>
        <a href="best.html" class="nav-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2l3 9h9l-7 5 3 9-8-5-8 5 3-9-7-5h9z" />
            </svg><span>ë² ìŠ¤íŠ¸</span></a>
        <a href="my.html" class="nav-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
                <circle cx="12" cy="7" r="4" />
            </svg><span>MY</span></a>
    </nav>
</body>

</html>