<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - CRAFIQ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="js/init-supabase.js"></script>
    <script type="module">
        import { getAllNovels, toggleFeatured, getFeaturedNovels } from './js/data.js';

        async function initAdmin() {
            const list = document.getElementById('adminList');
            const { data: allNovels } = await getAllNovels();
            const { data: featured } = await getFeaturedNovels();

            const featuredIds = new Set(featured.map(f => f.id));

            list.innerHTML = allNovels.map(n => `
                <div class="item" style="display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #333;">
                    <div style="display:flex; align-items:center; gap:10px;">
                        <img src="${n.cover_url || 'https://via.placeholder.com/50'}" style="width:40px; height:60px; object-fit:cover;">
                        <div>
                            <div style="font-weight:bold;">${n.title}</div>
                            <div style="font-size:12px; color:#888;">${n.profiles?.username || 'Unknown'}</div>
                        </div>
                    </div>
                    <button onclick="handleToggle('${n.id}')" 
                        style="padding:5px 10px; cursor:pointer; background:${featuredIds.has(n.id) ? '#e74c3c' : '#2ecc71'}; border:none; color:white; border-radius:4px;">
                        ${featuredIds.has(n.id) ? 'Remove Pick' : 'Add Pick'}
                    </button>
                </div>
            `).join('');
        }

        window.handleToggle = async (id) => {
            await toggleFeatured(id);
            location.reload();
        };

        window.addEventListener('DOMContentLoaded', initAdmin);
    </script>
</head>

<body style="background:#111; color:white; max-width:800px; margin:0 auto; padding:20px;">
    <h1>üëÆ‚Äç‚ôÇÔ∏è Admin Page</h1>
    <p>Manage MD's Pick and Curation.</p>
    <div id="adminList" style="margin-top:20px;">Loading...</div>
</body>

</html>